drop database dblab;
create database dblab;
use dblab;

CREATE TABLE guardian(
code TINYINT NOT NULL AUTO_INCREMENT,
first_name VARCHAR(255) NOT NULL,
last_name VARCHAR(255) NOT NULL,
street VARCHAR(255) NOT NULL,
number TINYINT NOT NULL,
city VARCHAR(255) NOT NULL,
postal_code INT NOT NULL,
PRIMARY KEY(code)
)ENGINE=InnoDB;

CREATE TABLE class(
code TINYINT NOT NULL AUTO_INCREMENT,
capacity TINYINT NOT NULL,
equipment TEXT,
children_number TINYINT NOT NULL,
PRIMARY KEY(code)
)ENGINE=InnoDB;

CREATE TABLE child(
code TINYINT NOT NULL AUTO_INCREMENT,
first_name VARCHAR(255) NOT NULL,
last_name VARCHAR(255) NOT NULL,
gender VARCHAR(255) NOT NULL,
birthdate DATE NOT NULL,
age TINYINT NOT NULL,
allergies TEXT,
guardian_code TINYINT NOT NULL,
class_code TINYINT NOT NULL,
PRIMARY KEY(code),
CONSTRAINT FKChildsGuardian FOREIGN KEY(guardian_code) REFERENCES guardian(code) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FKChildsClass FOREIGN KEY(class_code) REFERENCES class(code) ON DELETE RESTRICT ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE telephone_numbers(
guardian_code TINYINT NOT NULL,
telephone BIGINT NOT NULL,
PRIMARY KEY(guardian_code, telephone),
UNIQUE(telephone),
CONSTRAINT FKGuardian FOREIGN KEY(guardian_code) REFERENCES guardian(code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE activity(
code TINYINT NOT NULL AUTO_INCREMENT,
description TEXT NOT NULL,
PRIMARY KEY(code)
)ENGINE=InnoDB;

CREATE TABLE participation(
child_code TINYINT NOT NULL,
activity_code TINYINT NOT NULL,
performance TINYINT NOT NULL,
participation_date DATE NOT NULL,
PRIMARY KEY(child_code, activity_code),
CONSTRAINT FKChild FOREIGN KEY(child_code) REFERENCES child(code) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FKActivity FOREIGN KEY(activity_code) REFERENCES activity(code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE daily_report(
report_date DATE NOT NULL,
food VARCHAR(255) NOT NULL,
accident TEXT,
notes TEXT,
child_code TINYINT NOT NULL,
PRIMARY KEY(report_date, child_code),
CONSTRAINT FKReportChild FOREIGN KEY(child_code) REFERENCES child(code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE employee(
ADT CHAR(8) NOT NULL,
first_name VARCHAR(255) NOT NULL,
last_name VARCHAR(255) NOT NULL,
AFM INT NOT NULL,
DOY VARCHAR(255) NOT NULL,
wage INT NOT NULL,
CV TEXT NOT NULL,
PRIMARY KEY(ADT),
UNIQUE(AFM)
)ENGINE=InnoDB;

CREATE TABLE kindergarten_teacher(
ADT CHAR(8) NOT NULL,
graduation_grade DECIMAL(4,2) NOT NULL,
graduation_department VARCHAR(255) NOT NULL,
supervisor CHAR(8) NOT NULL,
class_code TINYINT NOT NULL,
PRIMARY KEY(ADT),
CONSTRAINT FKTeacherADT FOREIGN KEY(ADT) REFERENCES employee(ADT) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FKSupervisor FOREIGN KEY(supervisor) REFERENCES employee(ADT) ON DELETE RESTRICT ON UPDATE CASCADE,
CONSTRAINT FKTeachersClass FOREIGN KEY(class_code) REFERENCES class(code) ON DELETE RESTRICT ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE driver(
ADT CHAR(8) NOT NULL,
driver_license BIGINT NOT NULL,
PRIMARY KEY(ADT),
CONSTRAINT FKDriversADT FOREIGN KEY(ADT) REFERENCES employee(ADT) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE cook(
ADT CHAR(8) NOT NULL,
experience TINYINT NOT NULL,
PRIMARY KEY(ADT),
CONSTRAINT FKCooksADT FOREIGN KEY(ADT) REFERENCES employee(ADT) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;

CREATE TABLE bus(
registration_number BIGINT NOT NULL,
service_date DATE NOT NULL,
mileage INT NOT NULL,
model VARCHAR(255) NOT NULL,
PRIMARY KEY(registration_number)
)ENGINE=InnoDB;

CREATE TABLE driving(
registration_number BIGINT NOT NULL,
driver_ADT CHAR(8) NOT NULL,
driving_date DATE NOT NULL,
PRIMARY KEY(registration_number, driver_ADT),
CONSTRAINT FKRegNumber FOREIGN KEY(registration_number) REFERENCES bus(registration_number) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FKDriverADT FOREIGN KEY(driver_ADT) REFERENCES driver(ADT) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=InnoDB;